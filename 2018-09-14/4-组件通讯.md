# 组件通讯

## 基础

组件之间的 **数据传递**、**事件传递** 即为 **组件通讯**

## 父子组件

### $refs

```js
this.$refs["ref_name"]
this.$refs["ref_name"].$options.name
this.$refs["ref_name"].data_attribute
this.$refs["ref_name"].function_name
```

### $children

```js
this.$children[0]
this.$children[0].$options
this.$children[0].data_attribute
this.$refs[0].function_name
```

### $parent

```js
this.$parent
this.$parent.$data
this.$parent.data_attribute
this.$parent.function_name
```

### prop

- camelCase vs kebab-case

```html
<!-- HTML 特性名称不区分大小写 -->
<!-- 最终 data-blogId 会转换成 data-blogid -->
<div data-blogId="1"></div>
<div data-blogid="1"></div>
```

```js
// 因此当你在子组件中声明一个 cameClass 的 prop 时
Vue.component("blog-post", {
    // 在 JS 中 prop 是 cameClass 的
    props: ["blogId"],
    template: "<div>{{ blogTitle }}</div>"
})
```

```html
<!-- 在 HTML 中是 kebab-case 的 -->
<blog-post blog-id="1"></blog-post>
```

- 传递静态、动态的 prop

```html
<!-- 静态的传递, 此时传递为 prop 数据类型为 String -->
<blog-post blog-id="1"></blog-post>
<!-- 动态的传递, 此时传递的 prop 数据类型与父组件中定义的数据类型一致 -->
<blog-post v-bind:blog-id="PARENT_COMPONENT_DATA_ATTRIBUTE"></blog-post>
```

### $attrs

```html
<!-- In Parent Component -->
<child-component data-abc="parent-attr-data"></child-component>
```

```js
// In Child Component
Vue.component("child-component", {
    template: "<div>{{ blogTitle }}</div>"
    // 不使用 prop 接收 data-abc
    mounted: function() {
        console.log(this.$attrs); // => {"data-abc": "parent-attr-data"}
    }
})
// 类似: 获取 DOM 对象后,获取特性名称对应的值
// $node.attr('data-abc');
```

### 双向绑定

- 父组件传递 prop 时, 添加 .sync 修饰符
```html
<!-- 详见 ChildTree.vue -->
<child-component :blog-id.sync="blog.id"></child-component>
```
- 子组件通过特殊的 update $emit 通知父组件更新相应的 prop
```js
Vue.component("child-component", {
    props: ["blogId"],
    data: function() {
        // 1. 声明一个 prop 副本
        id: this.blogId
    },
    watch: {
        // 2. 观察 prop, prop 变化时, 更新副本
        blogId(val){
            this.id = val
        },
        // 3. 观察 副本, 副本变化时, 通知父组件更新 prop
        id(val){
            this.$emit("update:blogId", val)
        }
    }
})
```


## 兄弟 & 祖孙组件通讯

- eventBus
```js
// 中央事件总线,就是一个空的 Vue 实例
const eventBus = new Vue();
```

```js
// child-two 组件通过 eventBus.$emit() 传递 "child-two-click" 事件
Vue.component("child-two", {
    template: "<div @click='click'>child-tow</div>",
    methods: {
        click: function(){
            eventBus.$emit("child-two-click", "child two say 'hi' to child one")
        }
    }
})

// 兄弟组件 child-one 通过 eventBus.$on() 监听 "child-two-click" 事件
Vue.component("child-one", {
    template: "<div>child-one</div>",
    mounted: function(){
        eventBus.$on("child-two-click", function(msg_from_child_one){
            console.log(msg_from_child_one); // => child two say 'hi' to child one
        })
    }
})
```

## 实战

- EOS 采购计划单详情